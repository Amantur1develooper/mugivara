{% extends "base.html" %}
{% load i18n %}

{% block content %}
<style>
  details summary { list-style: none; cursor: pointer; }
  details summary::-webkit-details-marker { display: none; }
</style>

<div class="max-w-6xl mx-auto px-4 py-6">

  <!-- HERO -->
  <div class="rounded-[28px] overflow-hidden ring-1 ring-black/5 shadow-[0_18px_60px_rgba(15,23,42,.10)] bg-white/90 backdrop-blur">
    <div class="p-5 sm:p-7 flex items-start justify-between gap-4">
      <div class="min-w-0">
        <div class="inline-flex items-center gap-2 rounded-full px-3 py-1 text-xs font-semibold bg-stone-900 text-white">
          üóìÔ∏è {% trans "–ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ" %}
        </div>

        <h1 class="mt-3 text-2xl sm:text-3xl font-extrabold tracking-tight text-stone-900">
          {{ branch.name_ru }}
        </h1>
        <div class="mt-1 text-stone-600 text-sm">
          {{ branch.address }}
        </div>

        <div class="mt-4 flex flex-wrap gap-2 text-xs">
          <span class="inline-flex items-center gap-2 rounded-full px-3 py-1 bg-emerald-50 text-emerald-800 ring-1 ring-emerald-200">
            <span class="h-2 w-2 rounded-full bg-emerald-500"></span> {% trans "–°–≤–æ–±–æ–¥–Ω–æ" %}
          </span>
          <span class="inline-flex items-center gap-2 rounded-full px-3 py-1 bg-rose-50 text-rose-800 ring-1 ring-rose-200">
            <span class="h-2 w-2 rounded-full bg-rose-500"></span> {% trans "–ó–∞–Ω—è—Ç–æ" %}
          </span>
          <span class="inline-flex items-center gap-2 rounded-full px-3 py-1 bg-white ring-1 ring-stone-200 text-stone-700">
            ‚ÑπÔ∏è {% trans "–ú–µ—Å—Ç–æ —Å—Ç–∞–Ω–µ—Ç —Å–≤–æ–±–æ–¥–Ω—ã–º, –∫–æ–≥–¥–∞ –∫–∞—Å—Å–∏—Ä/–∞–¥–º–∏–Ω —Å–Ω–∏–º–µ—Ç –±—Ä–æ–Ω—å" %}
          </span>
        </div>
      </div>

      <a href="{% url 'public_site:branch_menu' branch.id %}"
         class="shrink-0 inline-flex items-center gap-2 px-4 py-2.5 rounded-2xl bg-white ring-1 ring-stone-200 hover:bg-stone-50 transition">
        ‚Üê {% trans "–ú–µ–Ω—é" %}
      </a>
    </div>
  </div>

  <!-- MESSAGES -->
  {% if messages %}
    <div class="mt-4 space-y-2">
      {% for m in messages %}
        <div class="rounded-2xl p-3 ring-1 ring-stone-200 bg-white/90 backdrop-blur text-stone-800">
          {{ m }}
        </div>
      {% endfor %}
    </div>
  {% endif %}

  <!-- FLOORS -->
  <div class="mt-6 space-y-10">
    {% for f in floors_data %}
      <section class="rounded-[28px] bg-white/90 backdrop-blur ring-1 ring-black/5 shadow-[0_14px_42px_rgba(15,23,42,.08)] overflow-hidden">

        <!-- Floor header -->
        <div class="px-5 sm:px-7 py-4 border-b border-stone-200 flex items-center justify-between">
          <div class="flex items-center gap-3">
            <div class="h-10 w-10 rounded-2xl bg-stone-900 text-white flex items-center justify-center font-extrabold">
              {{ forloop.counter }}
            </div>
            <div>
              <h2 class="text-lg sm:text-xl font-extrabold text-stone-900">
                {{ f.floor.name_ru }}
              </h2>
              <div class="text-sm text-stone-500">{% trans "–≠—Ç–∞–∂" %}</div>
            </div>
          </div>
        </div>

        <!-- Cards grid -->
        <div class="p-5 sm:p-7">
          <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-5">
            {% for row in f.places %}
              {% with p=row.obj busy=row.busy %}

              <div class="group rounded-[24px] overflow-hidden ring-1 ring-stone-200 bg-white
                          shadow-[0_10px_30px_rgba(15,23,42,.08)]
                          hover:shadow-[0_16px_55px_rgba(15,23,42,.14)]
                          transition">

                <!-- Photo -->
                <div class="relative h-44 bg-stone-100 overflow-hidden">
                  {% if p.photo %}
                    <img src="{{ p.photo.url }}" alt=""
                         class="h-full w-full object-cover group-hover:scale-[1.03] transition duration-300"
                         loading="lazy" decoding="async">
                  {% else %}
                    <div class="h-full w-full bg-gradient-to-br from-stone-100 to-stone-200"></div>
                  {% endif %}

                  <!-- badge -->
                  <div class="absolute top-3 left-3">
                    {% if busy %}
                      <span class="inline-flex items-center gap-2 rounded-full px-3 py-1.5 text-[12px]
                                   bg-rose-600 text-white ring-1 ring-white/20">
                        <span class="h-2 w-2 rounded-full bg-white"></span>
                        {% trans "–ó–∞–Ω—è—Ç–æ" %}
                      </span>
                    {% else %}
                      <span class="inline-flex items-center gap-2 rounded-full px-3 py-1.5 text-[12px]
                                   bg-emerald-600 text-white ring-1 ring-white/20">
                        <span class="h-2 w-2 rounded-full bg-white"></span>
                        {% trans "–°–≤–æ–±–æ–¥–Ω–æ" %}
                      </span>
                    {% endif %}
                  </div>
                </div>

                <!-- Body -->
                <div class="p-4 sm:p-5">
                  <div class="flex items-start justify-between gap-3">
                    <div class="min-w-0">
                      <div class="text-lg font-extrabold text-stone-900 truncate">
                        {{ p.title }}
                      </div>
                      <div class="mt-1 text-sm text-stone-500">
                        {% if p.type == "cabin" %}üõãÔ∏è {% trans "–ö–∞–±–∏–Ω–∫–∞" %}{% else %}üçΩÔ∏è {% trans "–°—Ç–æ–ª" %}{% endif %}
                        ¬∑ {% trans "–ú–µ—Å—Ç" %}: <b class="text-stone-900">{{ p.seats }}</b>
                      </div>
                    </div>
                  </div>

                  {% if busy %}
                    <div class="mt-4 text-sm text-stone-500">
                      {% trans "–≠—Ç–æ –º–µ—Å—Ç–æ —É–∂–µ –∑–∞–Ω—è—Ç–æ. –í—ã–±–µ—Ä–∏—Ç–µ –¥—Ä—É–≥–æ–µ." %}
                    </div>
                  {% else %}
                    <!-- —Ä–∞—Å–∫—Ä—ã–≤–∞—é—â–∞—è—Å—è —Ñ–æ—Ä–º–∞ -->
                    <details class="mt-4">
                      <summary class="w-full inline-flex items-center justify-center gap-2 px-4 py-3 rounded-2xl
                                      bg-stone-900 text-white font-semibold hover:bg-stone-800 transition">
                        ‚úçÔ∏è {% trans "–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å" %}
                      </summary>

                      <div class="mt-3 rounded-2xl bg-stone-50 ring-1 ring-stone-200 p-4">
                        <form class="grid gap-2" method="post"
                              action="{% url 'public_site:reserve_create' branch.id p.id %}">
                          {% csrf_token %}

                          <div class="grid sm:grid-cols-2 gap-2">
                            <input name="name" placeholder="{% trans '–§–ò–û (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)' %}"
                                   class="w-full border border-stone-300 rounded-xl px-3 py-2 bg-white focus:outline-none focus:ring-2 focus:ring-stone-300">

                            <input name="phone" placeholder="{% trans '–¢–µ–ª–µ—Ñ–æ–Ω (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)' %}"
                                   class="w-full border border-stone-300 rounded-xl px-3 py-2 bg-white focus:outline-none focus:ring-2 focus:ring-stone-300">
                          </div>

                          <div class="grid sm:grid-cols-2 gap-2">
                            <input name="guests" type="number" min="1" value="2"
                                   class="w-full border border-stone-300 rounded-xl px-3 py-2 bg-white focus:outline-none focus:ring-2 focus:ring-stone-300">
                            <input name="comment" placeholder="{% trans '–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)' %}"
                                   class="w-full border border-stone-300 rounded-xl px-3 py-2 bg-white focus:outline-none focus:ring-2 focus:ring-stone-300">
                          </div>

                          <button class="mt-1 px-4 py-3 rounded-2xl bg-emerald-600 text-white font-semibold hover:bg-emerald-700 transition">
                            ‚úÖ {% trans "–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –±—Ä–æ–Ω—å" %}
                          </button>

                          <div class="text-xs text-stone-500 mt-1">
                            {% trans "–ü–æ—Å–ª–µ –±—Ä–æ–Ω–∏ –º–µ—Å—Ç–æ –±—É–¥–µ—Ç –∑–∞–Ω—è—Ç–æ –¥–ª—è –≤—Å–µ—Ö –¥–æ —Å–Ω—è—Ç–∏—è –∞–¥–º–∏–Ω–æ–º/–∫–∞—Å—Å–∏—Ä–æ–º." %}
                          </div>
                        </form>
                      </div>
                    </details>
                  {% endif %}

                </div>
              </div>

              {% endwith %}
            {% endfor %}
          </div>
        </div>

      </section>
    {% endfor %}
  </div>
</div>
{% endblock %}
