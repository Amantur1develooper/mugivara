{% extends "base.html" %}
{% load i18n %}

{% block content %}
<div class="max-w-6xl mx-auto px-4 py-6">
  <div class="flex items-start justify-between gap-4">
    <div>
      <h1 class="text-2xl font-extrabold">{% trans "Бронирование" %}</h1>
      <div class="text-stone-600 text-sm mt-1">{{ branch.name_ru }} · {{ branch.address }}</div>
    </div>

    <a href="{% url 'public_site:branch_menu' branch.id %}"
       class="px-4 py-2 rounded-xl ring-1 ring-stone-200 hover:bg-stone-50">
      ← {% trans "Меню" %}
    </a>
  </div>

  {% if messages %}
    <div class="mt-4 space-y-2">
      {% for m in messages %}
        <div class="rounded-2xl p-3 ring-1 ring-stone-200 bg-white">{{ m }}</div>
      {% endfor %}
    </div>
  {% endif %}

  <div class="mt-6 space-y-8">
    {% for f in floors_data %}
      <section class="rounded-3xl bg-white ring-1 ring-stone-200 p-5">
        <div class="flex items-center justify-between gap-3">
          <h2 class="text-xl font-extrabold">{{ f.floor.name_ru }}</h2>
          <div class="text-sm text-stone-500">{% trans "Этаж" %} · {{ forloop.counter }}</div>
        </div>

        <div class="mt-4 grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-3">
          {% for row in f.places %}
            {% with p=row.obj busy=row.busy %}
              <div class="rounded-2xl ring-1 ring-stone-200 p-4 {% if busy %}opacity-60{% else %}bg-white{% endif %}">
                <!-- DEBUG (можешь временно оставить) -->
                <div class="text-[11px] text-stone-400 mb-1">
                  {{ p.id }} / {{ p.title }}
                </div>

                <div class="font-extrabold">
                  {{ p.title }}
                  <span class="text-xs font-semibold text-stone-500">
                    · {% if p.type == "cabin" %}{% trans "Кабинка" %}{% else %}{% trans "Стол" %}{% endif %}
                  </span>
                </div>

                <div class="text-sm text-stone-500 mt-1">{% trans "Мест" %}: {{ p.seats }}</div>

                {% if busy %}
                  <div class="mt-3 inline-flex px-3 py-2 rounded-xl bg-stone-900 text-white text-sm font-semibold">
                    {% trans "Занято" %}
                  </div>
                {% else %}
                  <form class="mt-3 grid gap-2" method="post"
                        action="{% url 'public_site:reserve_create' branch.id p.id %}">
                    {% csrf_token %}

                    <input name="name" placeholder="{% trans 'Имя (необязательно)' %}"
                           class="w-full border border-stone-300 rounded-xl px-3 py-2">

                    <input name="phone" placeholder="{% trans 'Телефон (необязательно)' %}"
                           class="w-full border border-stone-300 rounded-xl px-3 py-2">

                    <input name="guests" type="number" min="1" value="2"
                           class="w-full border border-stone-300 rounded-xl px-3 py-2">

                    <input name="comment" placeholder="{% trans 'Комментарий (необязательно)' %}"
                           class="w-full border border-stone-300 rounded-xl px-3 py-2">

                    <button class="px-4 py-3 rounded-2xl bg-stone-900 text-white font-semibold">
                      {% trans "Забронировать" %}
                    </button>
                  </form>
                {% endif %}
              </div>
            {% endwith %}
          {% empty %}
            <div class="text-stone-500">{% trans "На этом этаже нет мест." %}</div>
          {% endfor %}
        </div>
      </section>
    {% empty %}
      <div class="rounded-2xl bg-white ring-1 ring-stone-200 p-6 text-stone-600">
        {% trans "Этажи не найдены. Добавь Floor и Place в админке." %}
      </div>
    {% endfor %}
  </div>
</div>
{% endblock %}
