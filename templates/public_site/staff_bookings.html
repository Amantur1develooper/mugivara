{% extends "base.html" %}
{% load i18n %}

{% block content %}
<div class="max-w-5xl mx-auto px-4 py-6">

  <div class="flex items-start justify-between gap-4">
    <div>
      <h1 class="text-2xl text-white font-extrabold">{% trans "Управление бронями" %}</h1>
      <div class="text-stone-600 text-white text-sm mt-1">{{ branch.name }} · {{ access.title }}</div>
    </div>
  </div>

  {% if messages %}
    <div class="mt-4 space-y-2">
      {% for m in messages %}
        <div class="rounded-2xl p-3 ring-1 ring-stone-200 bg-white">{{ m }}</div>
      {% endfor %}
    </div>
  {% endif %}

  <div class="mt-6">
    <h2 class="text-white font-extrabold">{% trans "Активные брони" %}</h2>

    {% if active %}
      <div class="mt-3 space-y-3">
        {% for b in active %}
          <div class="rounded-2xl bg-white ring-1 ring-stone-200 p-4 flex items-start justify-between gap-4">
            <div class="min-w-0">
              <div class="font-extrabold">
                {{ b.place.title }}
                <span class="text-xs font-semibold text-stone-500">· {{ b.get_status_display }}</span>
              </div>
              <div class="text-sm text-stone-600 mt-1">
                {% if b.customer_name %}{{ b.customer_name }}{% else %}{% trans "Без имени" %}{% endif %}
                {% if b.customer_phone %} · {{ b.customer_phone }}{% endif %}
              </div>
              <div class="text-sm text-stone-500 mt-1">
                {% trans "Гостей" %}: {{ b.guests_count|default:"—" }}
                {% if b.comment %} · {{ b.comment }}{% endif %}
              </div>
            </div>

            <div class="flex gap-2 flex-wrap justify-end">
              {% if b.status != "arrived" %}
                <form method="post" action="{% url 'public_site:staff_booking_set_status' access.token b.id 'arrived' %}">
                  {% csrf_token %}
                  <button class="px-3 py-2 rounded-xl bg-amber-500 text-white font-semibold">
                    {% trans "Гость пришёл" %}
                  </button>
                </form>
              {% endif %}

              <form method="post" action="{% url 'public_site:staff_booking_set_status' access.token b.id 'close' %}">
                {% csrf_token %}
                <button class="px-3 py-2 rounded-xl bg-emerald-600 text-white font-semibold">
                  {% trans "Освободили" %}
                </button>
              </form>

              <form method="post" action="{% url 'public_site:staff_booking_set_status' access.token b.id 'cancel' %}">
                {% csrf_token %}
                <button class="px-3 py-2 rounded-xl ring-1 ring-stone-200 hover:bg-stone-50">
                  {% trans "Отменить" %}
                </button>
              </form>
            </div>

          </div>
        {% endfor %}
      </div>
    {% else %}
      <div class="mt-3 rounded-2xl bg-white ring-1 ring-stone-200 p-5">
        {% trans "Активных броней нет." %}
      </div>
    {% endif %}
  </div>

  <div class="mt-10">
    <h2 class="text-lg text-white font-extrabold">{% trans "История" %}</h2>
    <div class="mt-3 rounded-2xl bg-white ring-1 ring-stone-200 overflow-hidden">
      <div class="divide-y divide-stone-200">
        {% for b in history %}
          <div class="p-3 text-sm flex justify-between gap-3">
            <div class="truncate">{{ b.place.title }} · {{ b.get_status_display }}</div>
            <div class="text-stone-500">#{{ b.id }}</div>
          </div>
        {% empty %}
          <div class="p-3 text-stone-500">{% trans "Пока пусто." %}</div>
        {% endfor %}
      </div>
    </div>
  </div>

</div>
{% endblock %}
