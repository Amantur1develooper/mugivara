{% extends "base.html" %}
{% load i18n %}

{% block title %}Санжи — рестораны{% endblock %}

{% block content %}
  <div style="padding:14px;">
    <!-- HERO -->
    <div style="display:flex; flex-direction:column; gap:10px; padding:8px 6px 14px;">
      <h1 style="margin:0; font-size:34px; letter-spacing:-.3px;">
        {% trans "Выберите ресторан" %}
      </h1>
      <p style="margin:0; color:var(--muted); max-width:760px; line-height:1.5;">
        {% trans "Найдите заведение, откройте меню и закажите доставку/самовывоз. В заведении — заказы по QR со стола." %}
      </p>
    </div>

    <!-- SEARCH / FILTERS -->
    <form method="get" style="display:flex; gap:10px; flex-wrap:wrap; padding:0 6px 14px;">
      <input
        name="q"
        value="{{ q }}"
        placeholder="{% trans 'Поиск ресторана...' %}"
        style="flex:1; min-width:240px; padding:11px 12px; border:1px solid var(--line); border-radius:14px; background:#fff;"
      >

      <label style="display:inline-flex; align-items:center; gap:10px; border:1px solid var(--line); border-radius:999px; padding:10px 12px; background:#fff; cursor:pointer;">
        <input type="checkbox" name="open_now" value="1" {% if open_now %}checked{% endif %}>
        <span style="font-size:14px;">{% trans "Открыто сейчас" %}</span>
      </label>

      <button class="btn" type="submit">{% trans "Найти" %}</button>
    </form>

    <!-- GRID -->
    <div style="
      display:grid;
      grid-template-columns: repeat(4, 1fr);
      gap:14px;
      padding:10px 6px 18px;
    " class="restaurants-grid">
      {% for c in cards %}
        <a href="{% url 'public_site:restaurant_detail' c.obj.slug %}"
           style="
             background:#fff;
             border:1px solid var(--line);
             border-radius:18px;
             box-shadow: 0 10px 30px rgba(15,23,42,.08);
             text-decoration:none;
             color:inherit;
             display:block;
             transition: transform .12s ease;
             overflow:hidden;
           "
           onmouseover="this.style.transform='translateY(-2px)'"
           onmouseout="this.style.transform='translateY(0)'"
        >
          <div style="display:flex; align-items:center; gap:12px; padding:14px;">
            <div style="width:54px; height:54px; border-radius:16px; background:#f1f5f9; border:1px solid var(--line); overflow:hidden; display:flex; align-items:center; justify-content:center;">
              {% if c.obj.logo %}
                <img src="{{  c.obj.logo.url  }}"
     loading="lazy"
     decoding="async"
     width="480" height="320"
     alt="">

                {% comment %} <img src="{{ c.obj.logo.url }}" alt="{{ c.obj.name }}" style="width:100%; height:100%; object-fit:cover;"> {% endcomment %}
              {% else %}
                <span style="font-weight:900; color:#334155;">{{ c.obj.name|slice:":1" }}</span>
              {% endif %}
            </div>

            <div style="min-width:0;">
              <div style="font-weight:800; line-height:1.2; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">
                {{ c.obj.name }}
              </div>

              <div style="display:flex; gap:8px; flex-wrap:wrap; margin-top:8px; color:var(--muted); font-size:13px;">
                <span style="border:1px solid var(--line); border-radius:999px; padding:6px 10px; background:#fff;">
                  {% trans "Филиалов" %}: {{ c.branches_count }}
                </span>

                {% if c.is_open %}
                  <span style="border:1px solid var(--line); border-radius:999px; padding:6px 10px; background:#fff;">
                    {% trans "Открыто" %}
                  </span>
                {% else %}
                  <span style="border:1px solid var(--line); border-radius:999px; padding:6px 10px; background:#fff;">
                    {% trans "Закрыто" %}
                  </span>
                {% endif %}

                {% if c.hours_text %}
                  <span style="border:1px solid var(--line); border-radius:999px; padding:6px 10px; background:#fff;">
                    {{ c.hours_text }}
                  </span>
                {% endif %}

                {% if c.has_delivery %}
                  <span style="border:1px solid var(--line); border-radius:999px; padding:6px 10px; background:#fff;">
                    {% trans "Доставка" %}
                  </span>
                  {% if c.min_order != None %}
                    <span style="border:1px solid var(--line); border-radius:999px; padding:6px 10px; background:#fff;">
                      {% trans "Мин." %} {{ c.min_order }}
                    </span>
                  {% endif %}
                  {% if c.min_fee != None %}
                    <span style="border:1px solid var(--line); border-radius:999px; padding:6px 10px; background:#fff;">
                      {% trans "Дост." %} {{ c.min_fee }}
                    </span>
                  {% endif %}
                {% endif %}
              </div>
            </div>
          </div>
        </a>
      {% empty %}
        <div style="padding:14px; color:var(--muted);">
          {% trans "Ничего не найдено." %}
        </div>
      {% endfor %}
    </div>

    <style>
      @media (max-width: 980px){
        .restaurants-grid{ grid-template-columns: repeat(3, 1fr) !important; }
      }
      @media (max-width: 720px){
        .restaurants-grid{ grid-template-columns: repeat(2, 1fr) !important; }
        h1{ font-size: 28px !important; }
      }
      @media (max-width: 420px){
        .restaurants-grid{ grid-template-columns: 1fr !important; }
      }
    </style>
  </div>
{% endblock %}
