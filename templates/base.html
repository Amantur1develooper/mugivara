{% load static i18n %}
<!doctype html>
<html lang="{{ LANGUAGE_CODE }}">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://cdn.tailwindcss.com"></script>

{% block img %}
  <link rel="icon" type="image/jpg" sizes="32x32" href="{% static 'mini_logo.jpg' %}">
  <link rel="icon" type="image/jpg" sizes="16x16" href="{% static 'mini_logo.jpg' %}">
  <link rel="apple-touch-icon" href="{% static 'mini_logo.jpg' %}">
  <link rel="shortcut icon" href="{% static 'logo.jpg' %}">
{% endblock img %}
  <title>{% block title %}Онлайн меню Санжи{% endblock %}</title>

  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@400;600;700&family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --text:#0f172a;
      --muted:#64748b;
      --line:rgba(15,23,42,.10);
      --shadow: 0 12px 40px rgba(15,23,42,.10);
      --radius: 22px;
    }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color:var(--text);
      background: url("{% static 'санжи_фон2.png' %}") center / cover no-repeat fixed; 
    }

    .page-bg{
      position: fixed;
      inset: 0;
      z-index: -1;
      pointer-events:none;
      transform: translateZ(0);
      will-change: transform;
    }
    .page-bg::after{
      content:"";
      position:absolute;
      inset:0;
    }

    .surface{
      -webkit-backdrop-filter: blur(10px);
      border: 1px solid var(--line);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
    }

    .wrap{ max-width:1120px; margin:0 auto; padding:15px; }

    /* ===== TOPBAR (navbar) ===== */
    .topbar{
      display:flex; align-items:center; justify-content:space-between;
      gap:12px; padding:10px 2px 16px;
    }
    .brand{
      font-family:"Cormorant Garamond", serif;
      font-weight: 800;
      letter-spacing:.3px;
      font-size: 28px;
      line-height: 1;
      text-decoration:none;
      color: inherit;
    }
    .nav-links{ display:flex; gap:10px; align-items:center; }
    .nav-link{
      text-decoration:none;
      color: var(--text);
      font-weight: 800;
      padding: 10px 12px;
      border-radius: 999px;
      border: 1px solid transparent;
      transition: .12s ease;
    }
    .nav-link:hover{ background: rgba(15,23,42,.06); border-color: var(--line); }

    .lang{ display:flex; gap:8px; align-items:center; }
    .btn{
      border:1px solid var(--line);
      background:#fff;
      border-radius:999px;
      padding:8px 12px;
      cursor:pointer;
      transition: transform .12s ease, box-shadow .12s ease;
      font-weight: 700;
    }
    .btn:hover{ transform: translateY(-1px); box-shadow: 0 8px 20px rgba(15,23,42,.08); }

    /* ===== Burger ===== */
    .burger{
      display:none;
      width:44px; height:44px;
      border-radius: 16px;
      border:1px solid var(--line);
      background:#fff;
      align-items:center;
      justify-content:center;
      gap:5px;
      cursor:pointer;
    }
    .burger span{ display:block; width:18px; height:2px; background:#0f172a; border-radius:2px; }

    /* Fullscreen menu */
    .drawer{ position:fixed; inset:0; display:none; z-index:9999; }
    .drawer.open{ display:block; }
    .drawer .backdrop{ position:absolute; inset:0; background:rgba(0,0,0,.35); }
    .drawer .panel{
      position:absolute; inset:0;
      background:#fff;
      padding:18px 16px;
      display:flex;
      flex-direction:column;
    }
    .drawer .top{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }
    .drawer .title{
      font-weight: 900;
      font-size: 22px;
    }
    .drawer .close{
      width:44px;height:44px;
      border-radius:16px;
      border:1px solid var(--line);
      background:#fff;
      cursor:pointer;
      font-size:18px;
    }
    .drawer .links{
      margin-top:18px;
      display:flex;
      flex-direction:column;
      gap:12px;
    }
    .drawer .link{
      text-decoration:none;
      color:#0f172a;
      font-weight: 900;
      font-size: 22px;
      padding: 14px 14px;
      border-radius: 18px;
      border: 1px solid rgba(15,23,42,.10);
      background:#fff;
    }
    .drawer .link:hover{ background: rgba(15,23,42,.04); }

    .drawer .langbox{
      margin-top:auto;
      padding-top:14px;
      border-top:1px solid var(--line);
    }

    @media (max-width: 820px){
      .nav-links{ display:none; }
      .burger{ display:inline-flex; }
    }

    .footer{ border-top:1px solid var(--line); padding:18px 0; color:var(--muted); font-size:13px; }

    /* ===== Floating Cart ===== */
    .sj-cart-fab{
      position: fixed;
      right: 16px;
      bottom: 16px;
      z-index: 9998;
      display: inline-flex;
      align-items: center;
      gap: 10px;
      padding: 12px 14px;
      border-radius: 18px;
      background: rgba(15,23,42,.92);
      color: #fff;
      text-decoration: none;
      box-shadow: 0 18px 50px rgba(0,0,0,.25);
      border: 1px solid rgba(255,255,255,.12);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      transition: transform .12s ease, opacity .12s ease, box-shadow .12s ease;
      max-width: min(92vw, 420px);
    }
    .sj-cart-fab:hover{ transform: translateY(-2px); box-shadow: 0 22px 60px rgba(0,0,0,.28); }
    .sj-cart-fab.hide{ opacity: 0; pointer-events: none; transform: translateY(10px); }
    .sj-cart-fab__icon{
      width: 40px; height: 40px; border-radius: 14px;
      background: rgba(255,255,255,.12);
      display:flex; align-items:center; justify-content:center;
      flex:0 0 auto;
    }
    .sj-cart-fab__badge{
      margin-left: 2px;
      padding: 6px 10px;
      border-radius: 999px;
      background: rgba(255,255,255,.14);
      font-weight: 900;
      font-size: 12px;
      min-width: 28px;
      text-align:center;
      flex:0 0 auto;
    }
  </style>

  {% block head_extra %}{% endblock %}
</head>

<body>
  <div class="page-bg" aria-hidden="true"></div>

  <div class="wrap">

    <!-- ===== NAVBAR ===== -->
    <div class="topbar">
      <a class="brand" style="color: white;" href="{% url 'public_site:home' %}">Санжи</a>

      <nav class="nav-links">
          {% if branch %}
        <a class="nav-link" style="color: white;" href="{% url 'public_site:reservation' branch.id %}">{% trans "Бронирование" %}</a>

        {% comment %} <a class="nav-link" style="color: white;" href="{% url 'public_site:restaurant_contacts' restaurant.slug %}">{% trans "Контакты" %}</a> {% endcomment %}
        {% comment %} <a class="nav-link" style="color: white;" href="{% url 'public_site:about' %}">{% trans "О нас" %}</a> {% endcomment %}
        {% endif %}
      </nav>

      <div style="display:flex; gap:10px; align-items:center;">
        <!-- Languages desktop -->
        <div class="lang" style="display:flex; gap:8px;">
          <form action="{% url 'set_language' %}" method="post">
            {% csrf_token %}
            <input type="hidden" name="next" value="{{ request.path }}">
            <button class="btn" type="submit" name="language" value="ru">RU</button>
            <button class="btn" type="submit" name="language" value="ky">KY</button>
            <button class="btn" type="submit" name="language" value="en">EN</button>
          </form>
        </div>

        <!-- Burger -->
        <button class="burger" type="button" id="burgerBtn" aria-label="Menu" aria-controls="drawer" aria-expanded="false">
          <span></span><span></span><span></span>
        </button>
      </div>
    </div>

    <!-- Drawer -->
    <div class="drawer" id="drawer" aria-hidden="true">
      <div class="backdrop" data-close></div>
      <div class="panel" role="dialog" aria-modal="true">
        <div class="top">
          <div class="title">Санжи</div>
          <button class="close" type="button" data-close aria-label="Close">✕</button>
        </div>

        <div class="links">
         
           {% if branch %}
          <a class="link" href="{% url 'public_site:reservation' branch.id %}">{% trans "Бронирование" %}</a>
          {% comment %} <a class="link" href="{% url 'public_site:contacts' %}">{% trans "Контакты" %}</a> {% endcomment %}
          <a class="link" href="{% url 'public_site:about' %}">{% trans "О нас" %}</a>
          {% endif %}
          
        </div>

        <div class="langbox">
          <form action="{% url 'set_language' %}" method="post">
            {% csrf_token %}
            <input type="hidden" name="next" value="{{ request.path }}">
            <div style="display:flex; gap:8px; flex-wrap:wrap;">
              <button class="btn" type="submit" name="language" value="ru">RU</button>
              <button class="btn" type="submit" name="language" value="ky">KY</button>
              <button class="btn" type="submit" name="language" value="en">EN</button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- ===== CONTENT ===== -->
   
      {% block content %}{% endblock %}
   

    <div style="color:white;" class="footer">
      © Санжи — онлайн меню и заказы
    </div>
  </div>

  {% if table %}
          d
          {% else %}
  {% if branch %}
    <a href="{% url 'public_site:cart_detail' branch.id %}"
       class="sj-cart-fab "
       id="sjCartFab">
      <span class="sj-cart-fab__icon" aria-hidden="true">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 24 24">
          <path d="M7 18c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2-.9-2-2-2zm10
          0c-1.1 0-1.99.9-1.99 2S15.9 22 17 22s2-.9 2-2-.9-2-2-2zM7.16 14h9.45c.75
          0 1.4-.41 1.74-1.03l3.24-6.16A1 1 0 0 0 21.7 5H6.21L5.27 3H2v2h2l3.6
          7.59-1.35 2.44A2 2 0 0 0 6 16c0 1.1.9 2 2 2h12v-2H8l1.16-2z"/>
        </svg>
      </span>

      <span style="min-width:0;">
        <div style="font-weight:900; line-height:1.1;">{% trans "Корзина" %}</div>
        <div style="font-size:12px; color:rgba(255,255,255,.82); white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">
          <span data-cart-total>· {% if cart_total %} {% else %}0{% endif %} {% trans "сом" %}</span>
        </div>
      </span>

      <span class="sj-cart-fab__badge" data-cart-qty>
        {% if cart_qty %}{{ cart_qty }}{% else %}0{% endif %}
      </span>
    </a>
 {% endif %}

  {% endif %}

  <script>
    (function(){
      const btn = document.getElementById('burgerBtn');
      const drawer = document.getElementById('drawer');
      if(!btn || !drawer) return;

      const open = () => {
        drawer.classList.add('open');
        drawer.setAttribute('aria-hidden', 'false');
        btn.setAttribute('aria-expanded', 'true');
        document.documentElement.style.overflow = 'hidden';
      };

      const close = () => {
        drawer.classList.remove('open');
        drawer.setAttribute('aria-hidden', 'true');
        btn.setAttribute('aria-expanded', 'false');
        document.documentElement.style.overflow = '';
      };

      btn.addEventListener('click', open);

      drawer.addEventListener('click', (e) => {
        if (e.target && e.target.closest('[data-close]')) close();
      });

      drawer.querySelectorAll('a').forEach(a => a.addEventListener('click', close));

      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && drawer.classList.contains('open')) close();
      });
    })();
  </script>

</body>
</html>
